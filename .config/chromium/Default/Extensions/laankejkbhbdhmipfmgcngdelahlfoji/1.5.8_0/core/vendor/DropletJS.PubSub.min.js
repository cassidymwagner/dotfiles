!function(){window="undefined"!=typeof window?window:null,global="undefined"!=typeof global?global:null}(),function(e,s){var n;"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var s=this;return function(){return s.apply(e,arguments)}});var t=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.length},r=function(e){return"object"==typeof e&&null!==e&&"number"!=typeof e.length},i=function(e,n){try{delete e[n]}catch(t){e[n]=s}},o=function(e){if(this.namespace=this.DEFAULT_NS,e.indexOf(":")>-1&&(this.namespace=e.substr(0,e.indexOf(":")),e=e.substr(e.indexOf(":")+1,e.length)),e.indexOf(".")>-1){var s=e.split(".");this.msgArray=[s[0]||"*",s[1]||"*",s[2]||"*",s[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[e],this.msgString=e};o.prototype={DEFAULT_NS:"__default",matches:function(e){if(this.msgString===e)return!0;var s=this.msgArray,n=e.split(".");if(s.length!==n.length)return!1;for(var t="",r="",i=s.length>=n.length?s.length:n.length,o=0;o<i;o++){if("*"!==s[o]&&"*"!==n[o]&&s[o]!==n[o])return!1;t+="*"===s[o]?"0":"1",r+="*"===n[o]?"0":"1"}return t>=r},toString:function(){return this.msgString}};var a={handlers:{},subscribers:{before:[],after:[]},getAPI:function(){return{clear:this.clear.bind(this),listen:this.listen.bind(this),once:this.once.bind(this),publish:this.publish.bind(this),stop:this.stop.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this)}},listen:function(){var e=this.processListenArgs(Array.prototype.slice.call(arguments));return t(e.message)?(this.each(e,this.listen.bind(this)),null):void this.addHandler(e)},once:function(){var e=this.processListenArgs(Array.prototype.slice.call(arguments));return e.limit=1,t(e.message)?(this.each(e,this.once.bind(this)),null):void this.addHandler(e)},stop:function(e){if(e)throw new Error("Message(s) must be passed to stop()");var s={message:this.toMessage(e)};return t(s.message)?(this.each(s,this.stop.bind(this)),null):void this.removeHandlers(s)},subscribe:function(){var e=this.processSubscribeArgs(Array.prototype.slice.call(arguments)),s=e.phase;this.subscribers[s]=this.subscribers[s]||[],this.subscribers[s].push(e)},unsubscribe:function(){var e=this.processUnsubscribeArgs(Array.prototype.slice.call(arguments));if(!e.phase)return this.unsubscribe(e.namespace,"before"),this.unsubscribe(e.namespace,"after"),null;var s=e.namespace,n=e.phase,r=this.subscribers[n];if(t(r))for(var i=0;i<r.length;i++)s&&r[i].namespace!==s||r.splice(i,1)},publish:function(){var e=this.processPublishArgs(Array.prototype.slice.call(arguments));if(t(e.message)){var s=e.onComplete;return e.onComplete=null,this.each(e,this.publish.bind(this),s),null}for(var n=(e.message.toString(),e.message),r=e.payload,i=e.onPublish,o=this.subscribers.before.concat(this.getHandlers(n)).concat(this.subscribers.after),a=0;a<o.length;a++){if(null===o[a].limit||o[a].count<o[a].limit){var l=o[a].async?o[a].handler(n,r,i):o[a].handler(n,r);o[a].async!==!0&&"function"==typeof i&&i(l),o[a].count+=1}"number"==typeof o[a].limit&&o[a].count===o[a].limit&&this.removeHandlers(e,a)}"function"==typeof e.onComplete&&e.onComplete()},getHandlers:function(e){var s=[];for(var n in this.handlers)this.handlers.hasOwnProperty(n)&&e.matches(n)&&(s=s.concat(this.handlers[n]));return s},clear:function(){this.handlers={},this.subscribers={before:[],after:[]}},each:function(e,s,n){for(var t=0;t<e.message.length;t++){var r={};for(var i in e)e.hasOwnProperty(i)&&"message"!==i&&(r[i]=e[i]);r.message=e.message[t],s(r)}"function"==typeof n&&n()},addHandler:function(e){var s=e.message.toString();this.handlers[s]=this.handlers[s]||[],this.handlers[s].push({namespace:e.message.namespace,handler:e.handler,async:e.async,limit:"number"==typeof e.limit?e.limit:null,count:0})},removeHandlers:function(e,s){var n=e.message.toString(),t=e.message.namespace,r=this.handlers;if(r&&r[n]){if("number"==typeof s)r[n][s].namespace===t&&r[n].splice(s,1);else for(var o=0;o<r[n].length;o++)r[n][o].namespace===t&&r[n].splice(o,1);0===r[n].length&&i(r,n)}},processListenArgs:function(e){var s={};if(r(e[0])?s=e[0]:(s.message="string"==typeof e[0]||t(e[0])?e[0]:null,s.handler="function"==typeof e[1]?e[1]:null),!s.message||"function"!=typeof s.handler)throw new Error("Message(s) and handler function must be passed to listen() and/or once()");return s.message=this.toMessage(s.message),s},processSubscribeArgs:function(e){var s={};if(r(e[0])?s=e[0]:s.handler="function"==typeof e[0]?e[0]:null,"function"!=typeof s.handler)throw new Error("Handler must be passed to subscribe()");if(s.phase=s.phase||"after",s.limit=null,s.count=0,s.phase&&!(s.phase in{before:1,after:1}))throw new Error(s.phase+" is not a valid phase for subscribe().");return s},processUnsubscribeArgs:function(e){var s={};if(r(e[0])?s=e[0]:(s.namespace="string"==typeof e[0]?e[0]:null,s.phase="string"==typeof e[1]?e[1]:null),s.phase&&!(s.phase in{before:1,after:1}))throw new Error(s.phase+" is not a valid phase for unsubscribe().");return s},processPublishArgs:function(e){var s={};if(r(e[0])?s=e[0]:(s.message="string"==typeof e[0]||t(e[0])?e[0]:null,s.payload="undefined"!=typeof e[1]?e[1]:null),!s.message)throw new Error("Message(s) must be passed to publish()");return s.message=this.toMessage(s.message),s.async&&"function"!=typeof s.onPublish&&(s.onPublish=function(){}),s},toMessage:function(e){if(t(e)){for(var s=[],n=0;n<e.length;n++)e[n]instanceof o||(s[n]=new o(e[n]));e=s}else!e||e instanceof o||(e=new o(e));return e},log:function(e,s,n,t){},setLogLevel:function(e){n=e}};"function"==typeof define?define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:(e.DropletJS="object"==typeof e.DropletJS&&"null"!==e.DropletJS?e.DropletJS:{},e.DropletJS.PubSub=a)}(window||global);