var ContentScript=function(t){var e="HostNotInstalled",n="ExtensionNotInstalled",s=!0;return t.id=chrome.runtime.id,t.port=null,t.token_="",t.whiteList=[],t.hashList=[],t.initHashList=function(){t.hashList.push("X4WKTojPTBCkUep3mJ4lISkJd5xjgCy7t3WOV9ekcYQ="),t.hashList.push("64tUupzAFkz0sO9FdxdKzXPU1M+kX5addpE8cY8KwMY="),t.hashList.push("Y1UGgNTP1Q1s+ApMq8hsYXhEOhDHsCr5/q5bbvBFP/c="),t.hashList.push("eaShT5BXYGibkON42a7ewRxsy4+PSGtTMh2fG54Zf7A="),t.hashList.push("bzT9bgmTETuVqCgVxPDSjrnTqC6N14zH8kVD/pHJBdw="),t.hashList.push("Y1KRUKo4HpiaxizSb9jeqQR7pL82VYHg0CMQHD0EHHI="),t.hashList.push("1bIZVrqEKHJbytsxxLWDyOXWT4CQO7K46V4lOryJIJo=")},t.initWhiteList=function(){t.whiteList.push("atmccli.dll"),t.whiteList.push("ateccli.dll"),t.whiteList.push("wbxtccli.dll"),t.whiteList.push("wbxmgrtc.dll"),t.whiteList.push("wbxtcholcli.dll"),t.whiteList.push("tcholmgr.dll"),t.whiteList.push("atsc3cls.dll"),t.whiteList.push("atsccli.dll"),t.whiteList.push("atsccust.dll"),t.whiteList.push("ataactrl.dll"),t.whiteList.push("aasetup.dll"),t.whiteList.push("raagt.dll"),t.whiteList.push("atstctrl.dll"),t.whiteList.push("atplycli.dll"),t.whiteList.push("atrcp.dll"),t.whiteList.push("atshcli.dll"),t.whiteList.push("atconfui.bundle"),t.whiteList.push("wbxmgrmc.bundle"),t.whiteList.push("wbxmgrtc.bundle"),t.whiteList.push("wbxmgrec.bundle"),t.whiteList.push("tcholmgr.bundle"),t.whiteList.push("asplayback.bundle"),t.whiteList.push("nbrpfw.bundle"),t.whiteList.push("raconfui.bundle"),t.whiteList.push("pcnow client.app"),t.whiteList.push("pcnow process manager.app")},t.sendGoogleAnalyticMessage=function(t,e,n,s,i){chrome.runtime.sendMessage({platform:t,action:e,label:n,serviceType:s,result:i},function(t){})},t.sendLog=function(e,n){try{if(navigator.platform.match(/win/i)){var s=JSON.parse(e.message),i="Win",o=s.GpcUrlRoot,a=t.getServiceType(s);o&&t.sendGoogleAnalyticMessage(i,"GpcUrlRoot",o.trim(),a,n);var r=s.GpcExtName;r&&t.sendGoogleAnalyticMessage(i,"GpcExtName",r,a,n);var c=s.GpcUnpackName;c&&t.sendGoogleAnalyticMessage(i,"GpcUnpackName",c,a,n);var l=s.GpcInitCall;l&&t.sendGoogleAnalyticMessage(i,"GpcInitCall",atob(l.trim()),a,n);var p=s.GpcExitCall;p&&t.sendGoogleAnalyticMessage(i,"GpcExitCall",atob(p.trim()),a,n);var h=s.GpcComponentName;h&&(h=atob(h).trim().toLowerCase(),t.sendGoogleAnalyticMessage(i,"GpcComponentName",h,a,n))}}catch(u){console.log("[ContentScript] sendLog: err=",u)}},t.getServiceType=function(t){var e=t.GPCServiceType,n=t.productname,s=t.GpcComponentName;if(e){if("1"==e)return"MC";if("6"==e)return"EC";if("7"==e)return"TC";if("9"==e)return"SC"}else{if(n)return btoa(n).toLowerCase();if(s){if(s=atob(s).trim().toLowerCase(),"atmccli.dll"==s)return"MC";if("ateccli.dll"==s)return"EC";if("wbxtccli.dll"==s)return"TC";if("atsc3cls.dll"==s)return"SC"}}return"OTHER"},t.verifyScriptCall=function(e){var n=/^(WebEx_|As[ADEPS]|RA[AM])|^(Ex|In)it|^(FinishC|Is[NS]|JoinM|[NM][BCS][JRUC]|Set|Name|Noti|Trans|Update)|^(td|SCSP)$/;if(e.length>10240)return!1;for(var s=e.split(";"),i=0;i<s.length;i++){var o=s[i].trim(),a="",r=o.indexOf("=");if(r>=0){var c=o.substring(0,r).trim();if("szCookie"!=c)return!1;o=o.substring(r+1).trim()}r=o.indexOf("("),r>=0&&(a=o.substring(r+1),o=o.substring(0,r).trim());var l=a.split(",");if(a.length>1024||l.length>20)return!1;if(o.length>0&&!o.match(n))return!1;if(o.match(/2$/))return!1;for(var p=t.crypto(o),h=0;h<t.hashList.length;h++)if(p==t.hashList[h])return!1}return!0},t.verify=function(e){if("connect"!=e.message_type&&"disconnect"!=e.message_type&&"launch_meeting"!=e.message_type)return!1;if("launch_meeting"==e.message_type){try{if("string"!=typeof e.message)return!1;if(e.message.includes("\\u0000"))return!1;var n=JSON.parse(e.message),s="";if(navigator.platform.match(/win/i)){s="Win";var i=n.GpcExtName;if(i&&(i=i.trim(),"atgpcext"!=i.toLowerCase()&&"atgpcext"!=atob(i).toLowerCase().trim()))return!1;var o=n.GpcUnpackName;if(o&&(o=o.trim(),"atgpcdec"!=o.toLowerCase()&&"atgpcdec"!=atob(o).toLowerCase().trim()))return!1;var a=n.GpcInitCall;if(a&&!t.verifyScriptCall(atob(a.trim())))return!1;var r=n.GpcExitCall;if(r&&!t.verifyScriptCall(atob(r.trim())))return!1}else{if(!navigator.platform.match(/mac/i))return!1;s="Mac";var i=n.GpcExtName.trim();if("atgpcext64"!=i.toLowerCase()&&"atgpcext64"!=atob(i).toLowerCase().trim())return!1}var c=n.GpcComponentName.toLowerCase().trim();null==c.match(/\.dll$|\.bundle$|\.app$/)&&(c=atob(n.GpcComponentName),c=c.toLowerCase().trim());var l=0;for(l=0;l<t.whiteList.length;l++)if(c==t.whiteList[l])return!0}catch(p){console.log("[ContentScript]:",p)}return!1}return!0},t.handleStateChanged=function(s){console.log("[ContentScript] handleStateChanged: result=",s);var i={timestamp:(new Date).toUTCString(),token:ContentScript.token_,message_type:"state_changed",message:{ExtState:{result:s,reason:s?"ok":n},HostState:{result:!1,reason:e}}};t.handleNativeMessage(i)},t.handleNativeMessage=function(t){console.log("[ContentScript] handleNativeMessage: message=",t);var e=new CustomEvent("native_message",{detail:t});s?window.parent.document.dispatchEvent(e):document.dispatchEvent(e)},t.handleNativeDisconnect=function(e){console.log("[ContentScript] port.onDisconnect: self.port=",t.port);var n={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"disconnect",message:"disconnect"};t.port=null,t.handleNativeMessage(n)},t.sendMessage=function(e,n){console.log("[ContentScript] sendMessage: self.port=",t.port),console.log("[ContentScript] sendMessage: message=",e);try{if(!t.verify(e)){"launch_meeting"==e.message_type&&t.sendLog(e,"Illegal");var s={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"error",message:{error_code:1005,error_message:"BadDocshow"}};if(t.handleNativeMessage(s),null!=t.port){var i={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"disconnect",message:"disconnect"};t.port.postMessage(i)}return}"launch_meeting"==e.message_type&&(e.domain=window.location.protocol+"//"+window.location.host),null!=t.port&&t.port.postMessage(e)}catch(o){console.log("[ContentScript] sendMessage: err=",o);var s={timestamp:(new Date).toUTCString(),token:t.token_,message_type:"error",message:{error_code:-1,error_message:o.toString()}};t.handleNativeMessage(s),console.log(o.toString())}},t.connectPort=function(e){var n=window.location.host;if(console.log("[ContentScript] connectPort: extId=",e,"self.port=",t.port,"host=",n),null==t.port)try{t.port=chrome.runtime.connect(e,{name:t.token_}),console.log("[ContentScript] connectPort: self.port=",t.port),null!=t.port&&(t.port.onMessage.addListener(t.handleNativeMessage),t.port.onDisconnect.addListener(t.handleNativeDisconnect))}catch(s){console.log("[ContentScript] connectPort: err=",s),ContentScript.handleStateChanged(!1)}},t.crypto=function(t){var e=CryptoJS.SHA256(t);return e.toString(CryptoJS.enc.Base64)},t.init=function(){console.log("[ContentScript] init: chrome.runtime.id=",chrome.runtime.id),t.initWhiteList(),t.initHashList(),document.addEventListener("connect",function(e){console.log("[ContentScript] connect: e=",e),t.token_=e.detail.token,t.connectPort("")}),document.addEventListener("message",function(e){t.sendMessage(e.detail,t.handleNativeMessage)})},t}(ContentScript||{});ContentScript.init(),window.onload=function(){ContentScript.handleStateChanged(!0)};
