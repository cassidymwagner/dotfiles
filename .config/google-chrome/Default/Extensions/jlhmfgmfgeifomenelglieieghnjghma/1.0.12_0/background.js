var Background=function(e){var n={},o={},a="com.webex.meeting";return e.postMessageToPage=function(e,n){var a=o[e];if(console.log("[Background] postMessageToPage: name=",e),console.log("[Background] postMessageToPage: clientPort=",a),null!=a)try{console.log("[Background] postMessageToPage: message=",n),a.postMessage(n)}catch(t){console.log("[Background] postMessageToPage: err=",t.toString())}},e.postMessageToNative=function(o,a){var t=n[o];if(console.log("[Background] postMessageToNative: name=",o),console.log("[Background] postMessageToNative: nativePort=",t),null!=t)try{console.log("[Background] postMessageToNative: message=",a),t.postMessage(a)}catch(s){var c={timestamp:(new Date).toUTCString(),token:o,message_type:"error",message:{error_no:-1,error_message:s.toString()}};e.postMessageToPage(t.name,c),console.log("[Background] postMessageToNative: err=",s.toString())}},e.handleClientMessage=function(n,o){console.log("[Background] handleClientMessage: message=",n),console.log("[Background] handleClientMessage: clientPort=",o),e.postMessageToNative(o.name,n)},e.handleNativeMessage=function(n,o){console.log("[Background] handleNativeMessage: nativePort=",o),console.log("[Background] handleNativeMessage: message=",n),e.postMessageToPage(o.name,n)},e.handleNativeDisconnect=function(e){if(console.log("[Background] handleNativeDisconnect: nativePort=",e),null!=e){console.log("[Background] handleNativeDisconnect: lastError=",chrome.runtime.lastError.message),n[e.name]&&delete n[e.name],console.log("[Background] handleNativeDisconnect: nativePorts=",n);var a=o[e.name];if(console.log("[Background] handleNativeDisconnect: clientPort=",a),null!=a){var t={timestamp:(new Date).toUTCString(),token:a.name,message_type:"disconnect",message:chrome.runtime.lastError.message};a.postMessage(t),a.disconnect(),o[a.name]&&delete o[a.name],console.log("[Background] handleNativeDisconnect: clientPorts=",o)}}},e.handleClientDisconnect=function(a){console.log("[Background] handleClientDisconnect: clientPort=",a),o[a.name]&&delete o[a.name],console.log("[Background] handleClientDisconnect: clientPorts=",o);var t=n[a.name];if(null!=t){var s={timestamp:(new Date).toUTCString(),token:t.name,message_type:"disconnect",message:"disconnect"};e.postMessageToNative(t.name,s),n[t.name]&&delete n[t.name]}},e.connectNative=function(o){var t=n[o];if(console.log("[Background] connectNative: name=",o),console.log("[Background] connectNative: nativePort=",t),void 0==typeof t||null==t)try{t=chrome.runtime.connectNative(a),t.name=o,t.onMessage.addListener(e.handleNativeMessage),t.onDisconnect.addListener(e.handleNativeDisconnect),console.log("[Background] connectNative: nativePort=",t),n[t.name]=t}catch(s){return console.log("[Background] connectNative: Failed connecting to native port,",s.toString()),null}return t},e.handleClientConnect=function(n){console.log("[Background] chrome.runtime.onConnect, clientPort=",n),n.onMessage.addListener(e.handleClientMessage),n.onDisconnect.addListener(e.handleClientDisconnect),o[n.name]=n;var a=e.connectNative(n.name);if(null!=a){var t={timestamp:(new Date).toUTCString(),token:n.name,message_type:"hello",message:"hello"};e.postMessageToNative(n.name,t)}},e.setupGoogleAnalytics=function(){console.log("[Background] setupGoogleAnalytics: window.ga=",window.ga),window.ga||(!function(){window.ga=function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=1*new Date;var e="script",n=document.createElement(e),o=document.getElementsByTagName(e)[0];n.async=1,n.src="analytics.js",o.parentNode.insertBefore(n,o)}(),ga("create","UA-90923124-1","auto"),ga("set","checkProtocolTask",null),ga("set","anonymizeIp",!0),ga("send","pageview"))},e.init=function(){console.log("[Background] init: hostName_=",a),e.setupGoogleAnalytics(),chrome.runtime.onConnect.addListener(e.handleClientConnect),chrome.runtime.onUpdateAvailable&&chrome.runtime.onUpdateAvailable.addListener(function(e){console.log("chrome.runtime.onUpdateAvailable, details=",e)}),chrome.runtime.onMessage.addListener(function(e,n){console.log("[Background] onMessage:",e);var o="WBX-Ext-Log-"+e.serviceType+"-"+e.platform+"-"+e.result,a=e.action,t=e.label;ga("send","event",o,a,t,1)})},e}(Background||{});window.addEventListener("load",function(){Background.init()},!1);
