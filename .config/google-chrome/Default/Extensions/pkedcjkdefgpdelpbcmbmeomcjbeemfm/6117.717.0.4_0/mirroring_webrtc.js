'use strict';var T4={TAB:0,ig:1,cj:2},U4=function(a){cb("MediaRouter.WebRtc.Start.Success",a,T4)};var Y4=function(a,b){of.call(this,b);this.s=a;this.a=new eb;this.h=vr(b.id);this.g=new eb;this.w=!1;this.l=null;this.u=!1;this.m=this.f=null;V4(this);W4(this);X4(this,new uf("GET_TURN_CREDENTIALS"))};ja(Y4,of);Y4.prototype.start=function(a){var b=this;return this.a.a.then(function(c){if(c.b)return Promise.reject(new Be("Mirroring already started"));if(b.l)return Promise.reject(new Be("Session permanently stopped"));b.f=new Sa("MediaRouter.WebRtc.Session.Launch");c.a.addStream(a);c.start();return b.g.a})};
Y4.prototype.stop=function(){var a=this;this.g.reject(new Be("Session stop requested."));this.m&&(this.m.a(),this.m=null);if(this.l)return this.l;this.u=this.w=!1;this.f=null;return this.l=this.a.a.then(function(a){a.stop()}).then(function(){return a.h.ta()}).catch(function(b){a.h.ta();throw b;})};
var V4=function(a){a.h.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.a.resolve(new zf(a.b.id,b.data.credentials));break;case "ANSWER":a.a.a.then(function(a){Hf(a,b.data)});break;case "KNOCK_ANSWER":a.u=!0;a.a.a.then(function(a){Hf(a,b.data)});break;case "STOP":a.g.reject(new Be("Stop signal received"));a.stop();break;default:throw new Be("Unknown message type: "+b.type);}}},W4=function(a){a.a.a.then(function(b){Df(b,function(b){X4(a,
new uf("OFFER",new wf(b,a.s,xf)))});Ef(b,function(b){X4(a,vf(b))});Af(b,function(){a.w=!0;X4(a,new uf("SESSION_START_SUCCESS"));!a.u&&a.f&&a.f.a();a.f=null;a.m=new Za("MediaRouter.WebRtc.Session.Length");a.g.resolve(a)});Cf(b,function(){X4(a,new uf("SESSION_END"))});Bf(b,function(b){a.w||a.g.reject(b);X4(a,new uf("SESSION_FAILURE"))})})},X4=function(a,b){a.h.sendMessage(b,Z4)},Z4={channelType:"cloud"};var $4=function(){df.call(this,"webrtc")};ja($4,df);h=$4.prototype;h.ne=function(a,b){return new Y4(a,b)};h.Me=function(){U4(0)};h.Je=function(){U4(1)};h.Nf=function(){U4(2)};h.Ke=function(){bb("MediaRouter.WebRtc.Session.End")};h.Le=function(a){cb("MediaRouter.WebRtc.Start.Failure",a,Ae)};h.Pd=function(){bb("MediaRouter.WebRtc.Stream.End")};var a5=new $4;bf("mr.mirror.webrtc.WebRtcService",a5);
